#include <ncurses.h>
#include <stdio.h>
#include <locale.h>

// Structure for storing information about a single bus
typedef struct tagITEM { //Setting a structure with information about buses
  int numberroute; // Here you can enter an array of characters (a string) with the route number
  int busfleetnumber; // Here you can enter an array of characters (a string) with the bus fleet number
  int starttimech;
  int starttimem;// Here you can enter an array of characters (a string) with the start time
  int endtimech;
  int endtimem;//Here you can enter an array of characters (a string) with the end time
  int routekm; //Here you can enter an array of characters with the all route in KM
} ITEM; // Setting a name for the structure type "ITEM"
//!RouteKM ввод в метрах приводить к км
// Array for a maximum of 100 buses
    ITEM Bus[100];
// Number of occupied elements in the array
    int Number = 0;

// A function to display all of the elements
void Print( void ) {
  int i; //Setting the counter
  initscr();
  noecho();
 // keypad(stdscr, true);

    printw("╔═══╦═══════════╦══════════════╦═════════╦═══════╦═══════╗\n"); //"Header" of the graphic
    printw("║ N ║NumberRoute║BusFleetNumber║StartTime║EndTime║RouteKm║\n"); //table when output
  for (i = 0; i < Number; i++) { //Setting the "for" counter to output array elements by number
      printw ("╠═══╬═══════════╬══════════════╬═════════╬═══════╬═══════╣\n");
    printw("║%3i║%11i║%14i║    %02i:%02i║  %02i:%02i║%7i║\n",
    i + 1, Bus[i].numberroute, Bus[i].busfleetnumber,
           Bus[i].starttimech, Bus[i].starttimem, Bus[i].endtimech,
           Bus[i].endtimem, Bus[i].routekm);
  }
  printw ("╚═══╩═══════════╩══════════════╩═════════╩═══════╩═══════╝\n"); //End of the graphic table
  getch();
  refresh();
  endwin();

} // End of 'Print' function

    // Function for deleting an element
void Del( void ) {

  char i; //Setting the counter
  char d, dt;

  initscr();
  noecho();
  keypad(stdscr, true);

  Print();

  printw("Enter the number of the item to delete > ");
  i = getch();
      i = i - 48;
      //putchar(d);
  if (i < 0 || i > Number) {
    printw("The element with the number %i does not exist\n", i);
    return;
  }

  

  for (i--; i < Number - 1; i++)
    Bus[i] = Bus[i + 1];

  Number --;
  getch();
  Print();
  refresh();
  endwin();
} // End of 'Del' function

// Function for adding an element
void Add( void ) {
char a;
int i = 0, ch = 0, dh = 0; ////Setting the counter
initscr();
  echo();
  keypad(stdscr, true);
  if (Number == 99) {
    printw("You can't add another element\n");
    return;
  }
  printw ("╔══════════════════════════╗\n");
  printw ("║Enter number route >      ║\n");
  printw ("╚══════════════════════════╝\n");
  while (dh != 1) {
    a = getch();
    while (a != '\n') {
        if ((a > 57) || (a < 48)) {
          while ((a > 57) || (a < 48)) {
            if (a != '\n') printw("Only numbers\n");
            a = getch();
          }
        }
	//if (a == KEY_DOWN) {
	//	a = ' ';
        //} 
        a = a - 48;
        ch = ch * 10 + a;
        dh = 1;
        a = getch();
        if (ch > 9999) {
          printw ("Overflow\n");
          dh = 0;
          ch = 0;
        }
    }
  }
  printw ("\n");
  Bus[Number].numberroute = ch;
  dh = 0;
  printw ("╔══════════════════════════╗\n");
  printw ("║Enter bus fleet number >  ║\n");
  printw ("╚══════════════════════════╝\n");
  while (dh != 1) {
    a = getch();
    while (a != '\n') {
        if ((a > 57) || (a < 48)) {
          while ((a > 57) || (a < 48)) {
            if (a != '\n') printw("Only numbers\n");
            a = getch();
          }
        }
        a = a - 48;
        ch = ch * 10 + a;
       // putchar(a);
        a = getch();
        dh = 1;
        if (ch > 99999) {
          printw ("Overflow\n");
          dh = 0;
          ch = 0;
        }
    }
  }
  Bus[Number].busfleetnumber = ch;
  //putchar ('\n');
  ch = 0;
  dh = 0;
  printw ("╔══════════════════════════╗\n");
  printw ("║Enter start time >        ║\n");
  printw ("╚══════════════════════════╝\n");
  while (dh != 1) {
  a = getch();
    while (a != '\n') {
        if ((a > 57) || (a < 48)) {
          while ((a > 57) || (a < 48)) {
		  if (a != '\n') printw("Only numbers\n");
            a = getch();
          }
        }
        a = a - 48;
        ch = ch * 10 + a;
        dh = 1;
        a = getch();
        if (ch > 23) {
            printw("The clock (hours) cannot be more than 23.\n");
            dh = 0;
            ch = 0;
        } else if (ch < 0) {
          printw("Hours (hours) cannot be less than 00.\n");
            dh = 0;
            ch = 0;
        }
    }
  }
    Bus[Number].starttimech = ch;
    dh = 0;
    ch = 0;
  while (dh != 1) {
    a = getch();
    while (a != '\n') {
        if ((a > 57) || (a < 48)) {
          while ((a > 57) || (a < 48)) {
            if (a != '\n') printw("Only numbers\n");
            a = getch();
          }
        }
        a = a - 48;
        ch = ch * 10 + a;
        a = getch();
        dh = 1;
        if (ch > 59) {
          printw ("The clock (minutes) cannot be more than 59.\n");
	  dh = 0;
          ch = 0;
        }
        if (ch < 0) {
          printw ("Hours (minutes) cannot be less than 00.\n");
          dh = 0;
          ch = 0;
        }
    }
  }
    Bus[Number].starttimem = ch;
    //putchar('\n');
  ch = 0;
  dh = 0;
    printw ("╔══════════════════════════╗\n");
    printw ("║Enter end time >          ║\n");
    printw ("╚══════════════════════════╝\n");
  while (dh != 1) {
    a = getch();
    while (a != '\n') {
        if ((a > 57) || (a < 48)) {
          while ((a > 57) || (a < 48)) {
            if (a != '\n') printw("Only numbers\n");
            a = getch();
          }
        }
        a = a - 48;
        ch = ch * 10 + a;
        //putchar(a);
        dh = 1;
        a = getch();
        if (ch > 23) {
            printw("The clock (hours) cannot be more than 23.\n");
            dh = 0;
            ch = 0;
        } else if (ch < 0) {
            printw("Hours (hours) cannot be less than 00.\n");
	     dh = 0;
            ch = 0;
        }
        if (ch == Bus[Number].starttimech) {
            printw("The interval between departure and arrival hoursis at least an hour!\n");
            dh = 0;
            ch = 0;
        }
    }
  }
    Bus[Number].endtimech = ch;
    //putchar('\n');
    dh = 0;
    ch = 0;
  while (dh != 1) {
    a = getch();
    while (a != '\n') {
        if ((a > 57) || (a < 48)) {
          while ((a > 57) || (a < 48)) {
            if (a != '\n') printw("Only numbers\n");
            a = getch();
          }
        }
        a = a - 48;
        ch = ch * 10 + a;
        //putchar(a);
        a = getch();
        dh = 1;
        if (ch > 59) {
          printw ("The clock (minutes) cannot be more than 59.\n");
          dh = 0;
          ch = 0;
        }
        if (ch < 0) {
          printw ("Hours (minutes) cannot be less than 00.\n");
          dh = 0;
          ch = 0;
	  }
    }
  }
    Bus[Number].endtimem = ch;
    //putchar('\n');
    dh = 0;
    ch = 0;
  printw ("╔══════════════════════════╗\n");
  printw ("║Enter route in m >        ║\n");
  printw ("╚══════════════════════════╝\n");
  while (dh != 1) {
    a = getch();
    while (a != '\n') {
      if ((a > 57) || (a < 48)) {
          while ((a > 57) || (a < 48)) {
            if (a != '\n') printw("Only numbers\n");
            a = getch();
          }
      }
      a = a - 48;
      ch = ch * 10 + a;
      //putchar(a);
      a = getch();
      dh = 1;
        if (ch > 999999) {
          printw ("Overflow\n");
          dh = 0;
          ch = 0;
        }
    }
  }
  ch = ch / 1000;
  Bus[Number].routekm = ch;
  //Bus[Number].routekm = '\0';
  //putchar ('\n');

  Number++;
  getch();
  refresh();
  endwin();
} // End of 'Add' function

// Function for ordering an array by number route
void SortNumberRoute( void ) {
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --) {
    for (i = 0; i < j; i ++) {
      if ((Bus[i].numberroute > Bus[i + 1].numberroute) > 0) {
        Temp = Bus[i];
        Bus[i] = Bus[i + 1];
        Bus[i + 1] = Temp;
      }
    }
  }
  Print();
} // End of 'SortNumberRoute' function

// Function for ordering an array by number route
void SortNumberRouteUbyvanie( void ) {
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --) {
    for (i = 0; i < j; i ++) {
      if ((Bus[i].numberroute < Bus[i + 1].numberroute) > 0) {
        Temp = Bus[i];
        Bus[i] = Bus[i + 1];
        Bus[i + 1] = Temp;
      }
    }
  }
  Print();
} // End of 'SortNumberRouteUbyvanie' function

// Function for ordering an array by bus fleet number
void SortBusFleetNumber( void ) {
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --) {
    for (i = 0; i < j; i ++) {
      if (Bus[i].busfleetnumber > Bus[i + 1].busfleetnumber > 0) {
        Temp = Bus[i];
        Bus[i] = Bus[i + 1];
        Bus[i + 1] = Temp;
      }
    }
  }
  Print();
} // End of 'SortBusFleetNumber' function

// Function for ordering an array by bus fleet number
void SortBusFleetNumberUbyvanie( void ) {
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --) {
    for (i = 0; i < j; i ++) {
      if (Bus[i].busfleetnumber < Bus[i + 1].busfleetnumber > 0) {
        Temp = Bus[i];
        Bus[i] = Bus[i + 1];
        Bus[i + 1] = Temp;
      }
    }
  }
  Print();
} // End of 'SortBusFleetNumberUbyvanie' function

// Function for ordering an array by start time
void SortStartTime( void ) {
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --) {
    for (i = 0; i < j; i ++) {
      if ((Bus[i].starttimech > Bus[i + 1].starttimech) > 0) {
        Temp = Bus[i];
        Bus[i] = Bus[i + 1];
        Bus[i + 1] = Temp;
      }
    }
  }
  Print();
} // End of 'SortStartTime' function

// Function for ordering an array by start time
void SortStartTimeUbyvanie( void ) {
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --) {
    for (i = 0; i < j; i ++) {
      if ((Bus[i].starttimech < Bus[i + 1].starttimech) > 0) {
        Temp = Bus[i];
        Bus[i] = Bus[i + 1];
        Bus[i + 1] = Temp;
      }
    }
  }
  Print();
} // End of 'SortStartTimeUbyvanie' function

// Function for ordering an array by end time
void SortEndTime( void ) {
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --) {
    for (i = 0; i < j; i ++) {
      if ((Bus[i].endtimech > Bus[i + 1].endtimech) > 0) {
        Temp = Bus[i];
        Bus[i] = Bus[i + 1];
        Bus[i + 1] = Temp;
      }
    }
  }
  Print();
} // End of 'SortEndTime' function

// Function for ordering an array by end time
void SortEndTimeUbyvanie( void ) {
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --) {
    for (i = 0; i < j; i ++) {
      if ((Bus[i].endtimech < Bus[i + 1].endtimech) > 0) {
        Temp = Bus[i];
        Bus[i] = Bus[i + 1];
        Bus[i + 1] = Temp;
      }
    }
  }
  Print();
} // End of 'SortEndTimeUbyvanie' function

// Function for ordering an array by route in KM
void SortRouteKM( void ) {
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --) {
    for (i = 0; i < j; i ++) {
      if ((Bus[i].routekm > Bus[i + 1].routekm) > 0) {
        Temp = Bus[i];
        Bus[i] = Bus[i + 1];
        Bus[i + 1] = Temp;
      }
    }
  }
  Print();
} // End of 'SortRouteKM' function

// Function for ordering an array by route in KM
void SortRouteKMUbyvanie( void ) {
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --) {
    for (i = 0; i < j; i ++) {
      if ((Bus[i].routekm < Bus[i + 1].routekm) > 0) {
        Temp = Bus[i];
        Bus[i] = Bus[i + 1];
        Bus[i + 1] = Temp;
      }
    }
  }
  Print();
} // End of 'SortRouteKMUbyvanie' function

int Menu() {

  setlocale(LC_ALL, "");

  int c = 0, k = 0;
  int i = 0, Curr = 0;
  initscr();
  noecho();
  keypad(stdscr, true);
  do {
	    if (Curr == 0) {
              printw (
              "╒═════════════════════════════╕\n"
              "│    0 : Exit          <<<    │\n"
              "╞═════════════════════════════╡\n");
            } else {
              printw (
              "╒═════════════════════════════╕\n"
              "│    0 : Exit                 │\n"
              "╞═════════════════════════════╡\n");
	    }
	    if (Curr == 1) {
              printw (
              "│    1 : Add           <<<    │\n"
              "╞═════════════════════════════╡\n");
            } else {
              printw (
              "│    1 : Add                  │\n"
              "╞═════════════════════════════╡\n");
            }
	    if (Curr == 2) {
              printw (
              "│    2 : Save in file  <<<    │\n"
              "╞═════════════════════════════╡\n");
            } else {
              printw (
              "│    2 : Save in file         │\n"
              "╞═════════════════════════════╡\n");
            }
            if (Curr == 3) {
              printw (
              "│    3 : Download      <<<    │\n"
              "╞═════════════════════════════╡\n");
            } else {
              printw (
              "│    3 : Download             │\n"
              "╞═════════════════════════════╡\n");
            }
	    if (Curr == 4) {
              printw (
              "│    4 : Print         <<<    │\n"
              "╞═════════════════════════════╡\n");
            } else {
              printw (
              "│    4 : Print                │\n"
              "╞═════════════════════════════╡\n");
            }
	    if (Curr == 5) {
              printw (
              "│    5 : Sort          <<<    │\n"
              "╞═════════════════════════════╡\n");
            } else {
              printw (
              "│    5 : Sort                 │\n"
              "╞═════════════════════════════╡\n");
            }
	    if (Curr == 6) {
              printw (
              "│    6 : Delete        <<<    │\n"
              "╞═════════════════════════════╡\n");
            } else {
              printw (
              "│    6 : Delete               │\n"
              "╞═════════════════════════════╡\n");
            }
	    if (Curr == 7) {
              printw (
              "│    7 : Change        <<<    │\n"
              "╘═════════════════════════════╛\n");
            } else {
              printw (
              "│    7 : Change               │\n"
              "╘═════════════════════════════╛\n");
            }
     	 printw("\n");

  k = getch();
    if (k == KEY_DOWN) {
            if (Curr == 7) Curr = 0;
            else Curr++;
            }
            clear();
    if (k == KEY_UP) {
	    if (Curr == 0) Curr = 7;
            else Curr--;
            }
            clear();

    } while (k != 10);
  getch();
  refresh();
  endwin();
  return Curr;
}


int MenuSort() {
    initscr();
    noecho();
    keypad(stdscr, true);

  int Curr = 1, k = 0;

  do {
    if (k == 1) {
    printw("╒══════════════════════════════════╕\n"
           "│    1 : Return            <<<     │\n"
           "╞══════════════════════════════════╡\n");
	   } else {
    printw("╒══════════════════════════════════╕\n"
           "│    1 : Return                    │\n"
           "╞══════════════════════════════════╡\n");
    }
    if (k == 2) {
    printw("│    2 : Number Route      <<<     │\n"
           "╞══════════════════════════════════╡\n");
           } else {
    printw("│    2 : Number Route              │\n"
           "╞══════════════════════════════════╡\n");
    }
    if (k == 3) {
    printw("│    3 : Bus Fleet Number  <<<     │\n"
           "╞══════════════════════════════════╡\n");
           } else {
    printw("│    3 : Bus Fleet Number          │\n"
           "╞══════════════════════════════════╡\n");
    }
    if (k == 4) {
    printw("│    4 : Start Time        <<<     │\n"
           "╞══════════════════════════════════╡\n");
           } else {
    printw("│    4 : Start Time                │\n"
           "╞══════════════════════════════════╡\n");
    }
    if (k == 5) {
    printw("│    5 : End Time          <<<     │\n"
           "╞══════════════════════════════════╡\n");
           } else {
    printw("│    5 : End Time                  │\n"
           "╞══════════════════════════════════╡\n");
    }
    if (k == 6) {
    printw("│    6 : Route KM          <<<     │\n"
           "╘══════════════════════════════════╛\n");
           } else {
    printw("│    6 : Route KM                  │\n"
           "╘══════════════════════════════════╛\n");
    }
    printw("\n");
    k = getch();
    if (k == KEY_DOWN) {
            if (Curr == 6) Curr = 1;
            else Curr++;
            }
            clear();
    if (k == KEY_UP) {
            if (Curr == 1) Curr = 6;
            else Curr--;
            }
            clear();

    } while (k != 10);
    getch();
    refresh();
    endwin();
    return Curr;
} // End of 'MenuSort' function

int MenuSortD() {
    initscr();
    noecho();
    keypad(stdscr, true);

  int Curr = 1, k = 0;

  do {
    if (k == 1) {
    printw("╒══════════════════════════════════╕\n"
           "│    1 : Return            <<<     │\n"
           "╞══════════════════════════════════╡\n");
           } else {
    printw("╒══════════════════════════════════╕\n"
           "│    1 : Return                    │\n"
           "╞══════════════════════════════════╡\n");
    }
    if (k == 2) {
    printw("│    2 : Number Route      <<<     │\n"
           "╞══════════════════════════════════╡\n");
           } else {
    printw("│    2 : Number Route              │\n"
           "╞══════════════════════════════════╡\n");
    }
    if (k == 3) {
    printw("│    3 : Bus Fleet Number  <<<     │\n"
           "╞══════════════════════════════════╡\n");
           } else {
    printw("│    3 : Bus Fleet Number          │\n"
           "╞══════════════════════════════════╡\n");
    }
    if (k == 4) {
    printw("│    4 : Start Time        <<<     │\n"
           "╞══════════════════════════════════╡\n");
           } else {
    printw("│    4 : Start Time                │\n"
           "╞══════════════════════════════════╡\n");
    }
    if (k == 5) {
    printw("│    5 : End Time          <<<     │\n"
           "╞══════════════════════════════════╡\n");
           } else {
    printw("│    5 : End Time                  │\n"
           "╞══════════════════════════════════╡\n");
    }
    if (k == 6) {
    printw("│    6 : Route KM          <<<     │\n"
           "╘══════════════════════════════════╛\n");
           } else {
    printw("│    6 : Route KM                  │\n"
           "╘══════════════════════════════════╛\n");
    }
    printw("\n");
    k = getch();
    if (Curr == KEY_DOWN) {
            if (Curr == 6) Curr = 1;
            else Curr++;
            }
            clear();
    if (k == KEY_UP) {
            if (Curr == 1) Curr = 6;
            else Curr--;
            }
            clear();

    } while (k != 10);
    getch();
    refresh();
    endwin();
    return Curr;
} // End of 'MenuSortD' function

int MenuSortChoice () {
    int Curr = 1, k;

    initscr();
    noecho();
    keypad(stdscr, true);
    do {
     if (k == 1) {
        printw ("╔═══════════════════════════════════════╗\n"
                "║         Select the sort type:         ║\n"
                "╠═══════════════════╦╦══════════════════╣\n"
                "║  1 - Decrease <<  ║║  2 - Increase    ║\n"
                "╚═══════════════════╩╩══════════════════╝\n");
     } else {
        printw ("╔═══════════════════════════════════════╗\n"
                "║         Select the sort type:         ║\n"
                "╠═══════════════════╦╦══════════════════╣\n"
                "║  1 - Decrease     ║║  2 - Increase << ║\n"
                "╚═══════════════════╩╩══════════════════╝\n");
     }
        k = getchar();
        if (k == KEY_LEFT) {
           if (Curr == 2) Curr = 1;
                else Curr++;
        }
        clear();
        if (k == KEY_RIGHT) {
           if (Curr == 1) Curr = 2;
                else Curr--;
        }
        clear();
    } while (k != 10);
    //if (Curr == 1) MenuSort();
    //if (Curr == 2) MenuSortD();
    getch();
    refresh();
    endwin();
    return Curr;
}

int main( void ) {
  int Selection;

 while ((Selection = Menu()) != 48 && Selection != 27) {
    switch (Selection) {
        case 0:
          return 0;
          break;
        case 1:
          Add();
          break;
        //case 2:
        //  Print();
        //  Save();
        //  break;
        //case 3:
        //  Print();
        //  Load();
        //  break;
        case 4:
          Print();
          break;
        case 5:
          MenuSortChoice();
          break;
        case 6:
          Del();
          break;
        //case 7:
        //  Change();
        //  Print();
        //  break;
    }
}
} // End the function of the main menu


int TypeSort (void) {
    int Selection;

    Selection = MenuSortChoice();
        switch (Selection) {
            case 1:
            MenuSort();
            break;
            case 2:
            MenuSortD();
            break;
        }
}

// Sorting menu function
int mainsort(void) {
  int Selection;

  while ((Selection = MenuSort()) != 48 && Selection != 27) {
    switch (Selection) {
    //case 1:
    //  main();
    //  break;
    case 2:
      SortNumberRoute();
      break;
    case 3:
      SortBusFleetNumber();
      break;
    case 4:
      SortStartTime();
      break;
    case 5:
      SortEndTime();
      break;
    case 6:
      SortRouteKM();
      break;
    }
  }
} //End sorting menu function

int mainsortD (void) {
    int Selection;
    while ((Selection = MenuSortD()) != 48 && Selection != 27) {
    switch (Selection) {
       // case 1:
       //   main();
       //   break;
        case 2:
          SortNumberRouteUbyvanie();
          break;
        case 3:
          SortBusFleetNumberUbyvanie();
          break;
        case 4:
          SortStartTimeUbyvanie();
          break;
        case 5:
          SortEndTimeUbyvanie();
          break;
        case 6:
          SortRouteKMUbyvanie();
          break;
    }
    }
}

