#include <stdio.h>
#include <conio.h>
#include <string.h>

// Structure for storing information about a single bus
typedef struct tagITEM { //Setting a structure with information about buses
  char numberroute[7]; // Here you can enter an array of characters (a string) with the route number
  char busfleetnumber[7]; // Here you can enter an array of characters (a string) with the bus fleet number
  char starttime[5]; // Here you can enter an array of characters (a string) with the start time
  char endtime[5]; //Here you can enter an array of characters (a string) with the end time
  char routekm[7]; //Here you can enter an array of characters (a string) with the all route in KM
} ITEM; // Setting a name for the structure type "ITEM"
// Array for a maximum of 100 buses
    ITEM Bus[100];
// Number of occupied elements in the array
    int Number = 0;

// A function to display all of the elements
void Print( void ) {
  int i; //Setting the counter
    printf("╔═══╦═══════════╦══════════════╦═════════╦═══════╦═══════╗\n"); //"Header" of the graphic
    printf("║ N ║NumberRoute║BusFleetNumber║StartTime║EndTime║RouteKm║\n"); //table when output
  for (i = 0; i < Number; i++) { //Setting the "for" counter to output array elements by number
      printf ("╠═══╬═══════════╬══════════════╬═════════╬═══════╬═══════╣\n");
    printf("║%3i║%11s║%14s║%9s║%7s║%7s║\n",
    i + 1, Bus[i].numberroute, Bus[i].busfleetnumber,
           Bus[i].starttime, Bus[i].endtime, Bus[i].routekm);
  }
  printf ("╚═══╩═══════════╩══════════════╩═════════╩═══════╩═══════╝\n"); //End of the graphic table
} // End of 'Print' function

// Function for adding an element
void Add( void ) {
char a;
int i = 0; ////Setting the counter
  if (Number == 99)
  {
    fprintf(stderr, "You can't add another element\n");
    return;
  }
  putchar ('\n');
  printf ("╔══════════════════════════╗\n");
  printf ("║Enter number route >      ║\n");
  printf ("╚══════════════════════════╝\n");
  a = getchar();
  for (i = 0; (a != '\n' && i < 7); i++) {
      //a = getchar();
    while (a != '\n') {
      Bus[Number].numberroute[i] = a;
      putchar(a);
      a = getchar();
    }
    putchar ('\n');
  }
  //putchar ('\n');
  //do {
  //  a = getchar();
  //  while (a != '\n') {
  //      putchar
  //  }
  //  if (a != 13) {
  //      Bus[Number].numberroute = a;
  //      i++;
  //  }
  //  } while ((i != 0 && i < 4) || (Bus[Number].numberroute != '\n'));
  //scanf("%i", &Bus[Number].numberroute);
  i = 0;
  printf ("╔══════════════════════════╗\n");
  printf ("║Enter bus fleet number >  ║\n");
  printf ("╚══════════════════════════╝\n");
  a = getchar();
  for (i = 0; (a != '\n' && i < 7); i++) {
      //a = getchar ();
    while (a != '\n') {
      Bus[Number].busfleetnumber[i] = a;
      putchar(a);
      a = getchar();
    }
    putchar ('\n');
  }
  //putchar ('\n');
  //do {
  //  a = getchar();
  //  Bus[Number].busfleetnumber = a;
  //  i++;
  //  } while ((i != 0 && i < 2) || (Bus[Number].busfleetnumber != '\n'));
  //scanf("%i", &Bus[Number].busfleetnumber);
  printf ("╔══════════════════════════╗\n");
  printf ("║Enter start time >        ║\n");
  printf ("╚══════════════════════════╝\n");
  a = getchar();
  for (i = 0; (i < 5); i++) {
      //a = getchar();
    while (a != '\n') {
      Bus[Number].starttime[i] = a;
      putchar(a);
      a = getchar();
    }
    putchar ('\n');
  }
  //putchar ('\n');
  //do {
  //  a = getchar();
  //  Bus[Number].starttime = a;
  //  i++;
  // } while ((i != 0 && i < 6) || (Bus[Number].starttime != '\n'));
  //scanf("%i", &Bus[Number].starttime);
  printf ("╔══════════════════════════╗\n");
  printf ("║Enter end time >          ║\n");
  printf ("╚══════════════════════════╝\n");
  a = getchar();
  for (i = 0; (i < 5); i++) {
      //a = getchar();
    while (a != '\n') {
      Bus[Number].endtime[i] = a;
      putchar(a);
      a = getchar();
    }
    putchar ('\n');
  }
  //putchar ('\n');
  //do {
  //  a = getchar();
  //  Bus[Number].endtime = a;
  //  i++;
  //  } while ((i != 0 && i < 6) || (Bus[Number].endtime != '\n'));
  //scanf("%i", &Bus[Number].endtime);
  printf ("╔══════════════════════════╗\n");
  printf ("║Enter route in km >       ║\n");
  printf ("╚══════════════════════════╝\n");
  a = getchar();
  for (i = 0; ((a != '\n') && (i < 7)); i++) {
      //a = getchar();
    while (a != '\n') {
      Bus[Number].routekm[i] = a;
      putchar(a);
      a = getchar();
    }
    putchar ('\n');
  }
  //putchar ('\n');
  //do {
  //  a = getchar();
  //  Bus[Number].routekm = a;
  //  i++;
  //  } while ((i != 0 && i < 10) || (Bus[Number].routekm != '\n'));
  //scanf("%i", &Bus[Number].routekm);

  Number++;
} // End of 'Add' function

// Function for deleting an element
void Del( void )
{
  int i; //Setting the counter
  char d;

  Print();
  printf("Enter the number of the item to delete > ");
  do {
    d = getchar();
    i = d;
    } while (d != '\n');
  //scanf("%i", &i);
  if (i < 1 || i > Number)
  {
    fprintf(stderr, "The element with the number %i does not exist\n", i);
    return;
  }

  for (i--; i < Number - 1; i++)
    Bus[i] = Bus[i + 1];

  Number --;
} // End of 'Del' function

//Function change information
void Change (void) {
    char a;
    int tapok = 0, Num = 0; //Setting the counters
    Print();
    printf ("╔════════════════════════════════════════════════════════════╗\n");
    printf ("║                                                            ║\n");
    printf ("║    Enter the line number where you want to make changes    ║\n");
    printf ("║                                                            ║\n");
    printf ("╚════════════════════════════════════════════════════════════╝\n");
    tapok = getchar();
    while (tapok != '\n') {
      Num = tapok;
      putchar (tapok);
      tapok = getchar();
    }
    putchar ('\n');
    //scanf ("%d", &Num);
    while ((a < 49 || a > 53) && a != 27) {
        printf ("╔════════════════════════════════════════════════════════════╗\n");
        printf ("║                                                            ║\n");
        printf ("║         Enter the desired character to change:             ║\n");
        printf ("║                                                            ║\n");
        printf ("╠════════════════════════════════════════════════════════════╣\n");
        printf ("║                                                            ║\n");
        printf ("║                 1 > Number Route                           ║\n");
        printf ("║                 2 > Bus Fleet Number                       ║\n");
        printf ("║                 3 > Start Time                             ║\n");
        printf ("║                 4 > End Time                               ║\n");
        printf ("║                 5 > Route in KM                            ║\n");
        printf ("║                                                            ║\n");
        printf ("╚════════════════════════════════════════════════════════════╝\n");
        tapok = getchar();
        while (tapok != '\n') {
          a = tapok;
          putchar (tapok);
          tapok = getchar();
        }
    putchar ('\n');
    }
    //scanf ("%d", tapok);
    switch (tapok) {
        case 49:
        scanf ("%s", &Bus[Num].numberroute);
        break;
        case 50:
        scanf ("%s", &Bus[Num].busfleetnumber);
        break;
        case 51:
        scanf ("%s", &Bus[Num].starttime);
        break;
        case 52:
        scanf ("%s", &Bus[Num].endtime);
        break;
        case 53:
        scanf ("%s", &Bus[Num].routekm);
        break;
    }
} 

// Function for ordering an array by number route
void SortNumberRoute( void )
{
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --)
    for (i = 0; i < j; i ++)
      if ((Bus[i].numberroute > Bus[i + 1].numberroute) > 0)
      {
        Temp = Bus[i].numberroute;
        Bus[i].numberroute = Bus[i + 1].numberroute;
        Bus[i + 1].numberroute = Temp;
      }
} // End of 'SortNumberRoute' function

// Function for ordering an array by number route
void SortNumberRouteUbyvanie( void )
{
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --)
    for (i = 0; i < j; i ++)
      if ((Bus[i].numberroute < Bus[i + 1].numberroute) > 0)
      {
        Temp = Bus[i].numberroute;
        Bus[i].numberroute = Bus[i + 1].numberroute;
        Bus[i + 1].numberroute = Temp;
      }
} // End of 'SortNumberRouteUbyvanie' function

// Function for ordering an array by bus fleet number
void SortBusFleetNumber( void )
{
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --)
    for (i = 0; i < j; i ++)
      if ((Bus[i].busfleetnumber > Bus[i + 1].busfleetnumber) > 0)
      {
        Temp = Bus[i].busfleetnumber;
        Bus[i].busfleetnumber = Bus[i + 1].busfleetnumber;
        Bus[i + 1].busfleetnumber = Temp;
      }
} // End of 'SortBusFleetNumber' function

// Function for ordering an array by bus fleet number
void SortBusFleetNumberUbyvanie( void )
{
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --)
    for (i = 0; i < j; i ++)
      if ((Bus[i].busfleetnumber < Bus[i + 1].busfleetnumber) > 0)
      {
        Temp = Bus[i].busfleetnumber;
        Bus[i].busfleetnumber = Bus[i + 1].busfleetnumber;
        Bus[i + 1].busfleetnumber = Temp;
      }
} // End of 'SortBusFleetNumberUbyvanie' function

// Function for ordering an array by start time
void SortStartTime( void )
{
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --)
    for (i = 0; i < j; i ++)
      if ((Bus[i].starttime > Bus[i + 1].starttime) > 0)
      {
        Temp = Bus[i].starttime;
        Bus[i].starttime = Bus[i + 1].starttime;
        Bus[i + 1].starttime = Temp;
      }
} // End of 'SortStartTime' function

// Function for ordering an array by start time
void SortStartTimeUbyvanie( void )
{
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --)
    for (i = 0; i < j; i ++)
      if ((Bus[i].starttime < Bus[i + 1].starttime) > 0)
      {
        Temp = Bus[i].starttime;
        Bus[i].starttime = Bus[i + 1].starttime;
        Bus[i + 1].starttime = Temp;
      }
} // End of 'SortStartTimeUbyvanie' function

// Function for ordering an array by end time
void SortEndTime( void )
{
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --)
    for (i = 0; i < j; i ++)
      if ((Bus[i].endtime > Bus[i + 1].endtime) > 0)
      {
        Temp = Bus[i].endtime;
        Bus[i].endtime = Bus[i + 1].endtime;
        Bus[i + 1].endtime = Temp;
      }
} // End of 'SortEndTime' function

// Function for ordering an array by end time
void SortEndTimeUbyvanie( void )
{
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --)
    for (i = 0; i < j; i ++)
      if ((Bus[i].endtime < Bus[i + 1].endtime) > 0)
      {
        Temp = Bus[i].endtime;
        Bus[i].endtime = Bus[i + 1].endtime;
        Bus[i + 1].endtime = Temp;
      }
} // End of 'SortEndTimeUbyvanie' function

// Function for ordering an array by route in KM
void SortRouteKM( void )
{
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --)
    for (i = 0; i < j; i ++)
      if ((Bus[i].routekm > Bus[i + 1].routekm) > 0)
      {
        Temp = Bus[i].routekm;
        Bus[i].routekm = Bus[i + 1].routekm;
        Bus[i + 1].routekm = Temp;
      }
} // End of 'SortRouteKM' function

// Function for ordering an array by route in KM
void SortRouteKMUbyvanie( void )
{
  int i, j; //Setting the counters
  ITEM Temp;

  for (j = Number - 1; j > 0; j --)
    for (i = 0; i < j; i ++)
      if ((Bus[i].routekm < Bus[i + 1].routekm) > 0)
      {
        Temp = Bus[i].routekm;
        Bus[i].routekm = Bus[i + 1].routekm;
        Bus[i + 1].routekm = Temp;
      }
} // End of 'SortRouteKMUbyvanie' function

// Function for reading an array from a file
void Load( void )
{
  FILE *F;
  int i; //Setting the counter

  if ((F = fopen("task1.dat", "rt")) == NULL)
  {
    fprintf(stderr, "The file cannot be opened for reading 'task1.dta'\n");
    return;
  }

  fscanf(F, "%i", &Number);
  for (i = 0; i < Number; i++)
    fscanf(F, "%s\n%s\n%s\n%s\n%s\n", &Bus[i].numberroute, &Bus[i].busfleetnumber,
    &Bus[i].starttime, &Bus[i].endtime, &Bus[i].routekm);

  fclose(F);
} // End of 'Load' function

// Function for saving an array in a file
void Save( void )
{
  FILE *F;
  int i; //Setting the counter

  if ((F = fopen("task1.dat", "wt")) == NULL)
  {
    fprintf(stderr, "The file cannot be opened for writing 'task1.dta'\n");
    return;
  }

  fprintf(F, "%i\n", Number);
  for (i = 0; i < Number; i++)
    fprintf(F, "%s\n%s\n%s\n%s\n%s\n", *Bus[i].numberroute, *Bus[i].busfleetnumber,
    *Bus[i].starttime, *Bus[i].endtime, *Bus[i].routekm);

  fclose(F);
} // End of 'Save' function

// Display the menu and read the number of the selected item
int Menu( void )
{
  char c, k = 0;
  int i = 0; //Setting the counter
  c = 0;
  while ((c < 48 || c > 55) && c != 27)
  {
    printf("╒══════════════════════╕\n"
           "│    0 : Exit          │\n"
           "╞══════════════════════╡\n"
           "│    1 : Add           │\n"
           "╞══════════════════════╡\n"
           "│    2 : Save in file  │\n"
           "╞══════════════════════╡\n"
           "│    3 : Download      │\n"
           "╞══════════════════════╡\n"
           "│    4 : Print         │\n"
           "╞══════════════════════╡\n"
           "│    5 : Sort          │\n"
           "╞══════════════════════╡\n"
           "│    6 : Delete        │\n"
           "╞══════════════════════╡\n"
           "│    7 : Change        │\n"
           "╘══════════════════════╛\n");
    k = getchar();
    while (k != '\n') {
      c = k;
      putchar (k);
      k = getchar();
    }
    putchar ('\n');
    fflush(stdin);
    //printf("%c\n", c);
  }
  return c;
} /* End of 'Menu' function */

int MenuSortChoice (void) {
    char c = 0, k = 0;
    while ((c < 49 || c > 50) && c != 27) {
        printf ("╔══════════════════════════════════╗\n");
        printf ("║      Select the sort type:       ║\n");
        printf ("╠════════════════╦╦════════════════╣\n");
        printf ("║  1 - Decrease  ║║  2 - Increase  ║\n");
        printf ("╚════════════════╩╩════════════════╝\n");
        k = getchar();
        while (k != '\n') {
          c = k;
          putchar (k);
          k = getchar();
        }
        putchar ('\n');
        fflush(stdin);
    }
    return c;
}

int MenuSort( void )
{
  char c, k = 0;
  c = 0;

  while ((c < 49 || c > 54) && c != 27)
  {
    printf("╒════════════════════════════╕\n"
           "│    1 : Return              │\n"
           "╞════════════════════════════╡\n"
           "│    2 : Number Route        │\n"
           "╞════════════════════════════╡\n"
           "│    3 : Bus Fleet Number    │\n"
           "╞════════════════════════════╡\n"
           "│    4 : Start Time          │\n"
           "╞════════════════════════════╡\n"
           "│    5 : End Time            │\n"
           "╞════════════════════════════╡\n"
           "│    6 : Route KM            │\n"
           "╘════════════════════════════╛\n");
    k = getchar();
    while (k != '\n') {
      c = k;
      putchar (k);
      k = getchar();
    }
    putchar ('\n');
    fflush(stdin);
  }
  return c;
} // End of 'MenuSort' function

// Display the menu and read the number of the selected item sort
int MenuSortD( void )
{
  char c, k = 0;
  c = 0;

  while ((c < 49 || c > 54) && c != 27)
  {
    printf("╒════════════════════════════╕\n"
           "│    1 : Return              │\n"
           "╞════════════════════════════╡\n"
           "│    2 : Number Route        │\n"
           "╞════════════════════════════╡\n"
           "│    3 : Bus Fleet Number    │\n"
           "╞════════════════════════════╡\n"
           "│    4 : Start Time          │\n"
           "╞════════════════════════════╡\n"
           "│    5 : End Time            │\n"
           "╞════════════════════════════╡\n"
           "│    6 : Route KM            │\n"
           "╘════════════════════════════╛\n");
    k = getchar();
    while (k != '\n') {
      c = k;
      putchar (k);
      k = getchar();
    }
    putchar ('\n');
    fflush(stdin);
  }
  return c;
} // End of 'MenuSortD' function

// The function of the main menu
void main( void )
{
  int Selection;

 while ((Selection = Menu()) != 48 && Selection != 27)
    switch (Selection) {
        case 49:
          Print();
          Add();
          break;
        case 50:
          Print();
          Save();
          break;
        case 51:
          Print();
          Load();
          break;
        case 52:
          Print();
          break;
        case 53:
          MenuSortChoice();
          Print();
          break;
        case 54:
          Del();
          Print();
          break;
        case 55:
          Change();
          Print();
          break;
    }
} // End the function of the main menu

void TypeSort (void) {
    int Selection;
    
    while ((Selection = MenuSortChoice()) != 48 && Selection != 27)
        switch (Selection) {
            case 49:
            MenuSort();
            break;
            case 50:
            MenuSortD();
            break;
        }
}

// Sorting menu function
void mainsort( void )
{
  int Selection;

  while ((Selection = MenuSort()) != 48 && Selection != 27)
    switch (Selection)
    {
    case 49:
      main();
      break;
    case 50:
      SortNumberRoute();
      Print();
      break;
    case 51:
      SortBusFleetNumber();
      Print();
      break;
    case 52:
      SortStartTime();
      Print();
      break;
    case 53:
      SortEndTime();
      Print();
      break;
    case 54:
      SortRouteKM();
      Print();
      break;
    }
} //End sorting menu function

int mainsortD (void) {
    int Selection;
    while ((Selection = MenuSortD()) != 48 && Selection != 27)
    switch (Selection) {
        case 49:
          main();
          break;
        case 50:
          SortNumberRouteUbyvanie();
          Print();
          break;
        case 51:
          SortBusFleetNumberUbyvanie();
          Print();
          break;
        case 52:
          SortStartTimeUbyvanie();
          Print();
          break;
        case 53:
          SortEndTimeUbyvanie();
          Print();
          break;
        case 54:
          SortRouteKMUbyvanie();
          Print();
          break;
    }
}
